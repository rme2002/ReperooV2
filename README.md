# üß© Monorepo Starter Template

Unified workspace for the [YOURAPP] stack: a Next.js web app, an Expo mobile client, and a FastAPI backend that share a single OpenAPI contract.

---

## Repository Layout

| Path | Description |
|------|-------------|
| `apps/web` | Next.js + Mantine front-end (see [`apps/web/README.md`](apps/web/README.md)) |
| `apps/mobile` | Expo / React Native client (see [`apps/mobile/README.md`](apps/mobile/README.md)) |
| `apps/api` | FastAPI backend (see [`apps/api/README.md`](apps/api/README.md)) |
| `packages/openapi` | Source-of-truth OpenAPI specification (`api.yaml`) |
| `docker-compose.yml` | Local infrastructure (currently API only) |
| `scripts/` | Utility scripts (e.g., `dev-run.sh`) |

---

## Requirements

| Tool | Version | Notes |
|------|---------|-------|
| Node.js | ‚â• 20.x | Web + mobile apps |
| npm | comes with Node | |
| Python | ‚â• 3.13 | Backend + tooling |
| `uv` | latest | Python dependency manager |
| Docker | latest | API + infra services |
| Xcode / Android Studio | latest | Running the mobile client locally |

Each app README details its own environment variables and additional prerequisites.

---

## Local Development

### First-time setup

```bash
make setup   # installs uv deps for API + npm packages for web/mobile
```

### 1. Start backend services

```bash
docker compose up --build        # Start/refresh the FastAPI container
# or stop everything later
docker compose down
```

The API is available at [http://localhost:8080](http://localhost:8080).

### 2. Run apps natively

```bash
# Web
cd apps/web && npm install && npm run dev

# Mobile (iOS example)
cd apps/mobile && npm install && npx expo run:ios
```

### 3. One-command workflow (optional)

The Makefile orchestrates Docker + dev servers and cleans up on Ctrl+C:

```bash
make dev        # API + web + mobile
make dev-web    # API + web only
make dev-mobile # API + mobile only
```

Logs are prefixed (`[API]`, `[WEB]`, `[MOBILE]`, etc.) so you can see which service produced each line.

> **Ports:** API `8080`, Web `3000`, Expo Metro `19000/19001/19002` (auto-selected), Metro bundle `8081+`.

---

## Project Documents

| Area | Documentation |
|------|---------------|
| Web app | [`apps/web/README.md`](apps/web/README.md) |
| Mobile app | [`apps/mobile/README.md`](apps/mobile/README.md) |
| API | [`apps/api/README.md`](apps/api/README.md) |
| OpenAPI contract | [`packages/openapi/api.yaml`](packages/openapi/api.yaml) |

Each document covers environment variables, scripts, and workflow tips specific to that surface.

## OpenSpec Change Workflow

[OpenSpec](./openspec) provides a lightweight spec-first workflow so contributors describe changes before writing code. As the project owner, you mainly trigger the workflow and let Codex (or another assistant) do the scaffolding:

1. **Set the context** ‚Äì Ask Codex to read `openspec/project.md` (see the sample prompt generated by `openspec init`). Keep this file up to date whenever tech stack or conventions change.
2. **Decide if a spec is required** ‚Äì Use OpenSpec for net-new capabilities, behaviour changes (API contracts, UX, data models), architectural shifts, or performance/security work. Skip it for pure bug fixes, typo/doc/config tweaks, dependency bumps, or tests that simply cover existing behaviour.
3. **Request a proposal** ‚Äì When you need new functionality, tell Codex what you want (e.g., ‚ÄúI want to add team invites. Please create an OpenSpec change proposal for this feature‚Äù). The agent will pick a change ID, scaffold `proposal.md`/`tasks.md`, and draft spec deltas for you.
4. **Review & refine** ‚Äì If the proposal isn‚Äôt perfect, ask Codex to revise specific sections (‚Äúupdate the scenarios to cover passwordless login‚Äù, ‚Äúsplit the tasks by surface‚Äù). Iterate until the spec captures the desired behavior, then approve it.
5. **Wait for approval before coding** ‚Äì Once the proposal looks good, give the green light and ask Codex to implement the approved tasks. Codex will follow the checklist, run validations/tests, and keep the spec + code in sync.
6. **Wrap up** ‚Äì After deployment, ask Codex to archive the change (`openspec archive <id> --yes`) so the canonical specs under `openspec/specs/` stay current.

By following these prompts, anyone who forks/templates this repo can clone it, talk to Codex, and immediately have a clean OpenSpec-driven workflow without learning the tooling internals first.

---

## OpenAPI & Code Generation

`packages/openapi/api.yaml` is the single source of truth for request/response contracts. Each surface consumes that spec through its own generator:

| Surface | Tool | Output |
|---------|------|--------|
| API | `datamodel-codegen` (Pydantic v2) | `apps/api/src/models/model.py` |
| Web | `orval` (fetch client + models) | `apps/web/lib/gen/**` |
| Mobile | `orval` (fetch client + models) | `apps/mobile/lib/gen/**` |

Run everything at once with:

```bash
make generate-api
```

Orcall individual commands if you need to iterate quickly:

```bash
# API data models
cd apps/api
uv run datamodel-codegen --input ../../packages/openapi/api.yaml --input-file-type openapi --output src/models/model.py --output-model-type pydantic_v2.BaseModel --target-python-version 3.13

# Web client
cd apps/web
npm run generate-api

# Mobile client
cd apps/mobile
npm run generate-api
```

Check regenerated files into git so the rest of the stack stays in sync.

---

## CI/CD Snapshot

- **GitHub Actions** ‚Äì lint/test/build per app.
- **OpenAPI contract** ‚Äì generated models referenced by API + clients.
- **Cloud Build / Cloud Run** ‚Äì backend deployment pipeline.
- **Vercel** ‚Äì web deployment from `main`.

---

## Handy Commands

| Command | Purpose |
|---------|---------|
| `make setup` | Install/sync dependencies (`uv sync` + `npm install`) |
| `make clean` / `make setup-clean` | Remove cached deps (uv/node_modules) or clean+reinstall |
| `make lint` / `make lint-fix` | Run ESLint/Ruff checks (or auto-fix) across API + web + mobile |
| `make generate-api` | Regenerate backend models + web/mobile Orval clients from OpenAPI |
| `make dev` / `make dev-web` / `make dev-mobile` | Start Docker API + local dev servers (auto cleanup on exit) |
| `docker compose up --build` / `down` | Manage API container manually |
| `cd apps/web && npm run dev` | Web dev server only |
| `cd apps/mobile && npx expo run:ios` | Launch Expo + simulator |
| `cd apps/api && uv run uvicorn src.main:app --reload` | Run FastAPI locally (see API README) |
